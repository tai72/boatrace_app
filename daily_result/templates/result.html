{% extends 'base.html' %}

{% load static %}

{% block title %}Daily Result{% endblock title %}

{% block head %}
<link type="text/css" rel="stylesheet" href="{% static 'css/daily_result.css' %}">
{% endblock head %}

{% block contents %}
<section class="container-contents-outer" id="section-daily-result">
    <div class="container-contents-inner align-center wrapper-title">
        <h1 class="main-header">１日の成績</h1>
    </div>
    <section class="section-dailyResult">
        <div class="dailyResult">
            <div class="wrapper-canvas">
                <canvas id="canvas" width="250px" height="300px"></canvas>
            </div>
            <div class="wrapper-text">
                <div class="wrapper-result">
                    <div class="resultText">
                        <p>収支</p>
                    </div>
                    <div class="resultValue">
                        <h2>{{ benefit }}<span>円</span></h2>
                    </div>
                </div>
                <div class="wrapper-result">
                    <div class="resultText">
                        <p>回収率</p>
                    </div>
                    <div class="resultValue">
                        <h2>{{ benefit_rate }}<span>%</span></h2>
                    </div>
                </div>
            </div>
        </div>
    </section>
</section>

<!-- 買い目ごとの配当金の割合 -->

<section id="daily-result-each-comb">
    <div class="align-center wrapper-title">
        <h2>買い目ごとの成績</h2>
    </div>
    <div class="result-each-comb-content">
        <div class="wrapper-pie-chart">
            <canvas id="pie-chart" width="300px" height="300px"></canvas>
        </div>
    </div>
</section>

<script>
    (function() {

        // ~~~ １日の成績 ~~~

        var buySum = '{{ buy }}';
        var dividend = '{{ return_sum }}';
        var benefit = '{{ benefit }}';
        let heights = Array();

        if (benefit >= 0) {
            heights = [250 * (buySum / dividend), 250];
            console.log(heights);
        } else {
            heights = [250, 250 * (dividend / buySum)];
            console.log(heights);
        };

        const elm = document.getElementById('canvas');
        const ctx = elm.getContext('2d');

        const barColor = ['#808080', '2f4f4f'];
        const barText = ['購入金額', '配当金'];
        const barTextVal = [buySum, dividend];
        const barWidth = 80;
        const barSpace = 30;
        for (let i=0; i<heights.length; i++) {
            let x = (i * barWidth) + i*barSpace + 30;
            let y = heights[i];

            ctx.fillStyle = barColor[i];
            ctx.textAlign = 'center';
            ctx.font = '20px Arial';
            ctx.fillRect(x, 300, barWidth, -y);
            ctx.fillText(barTextVal[i], x + 40, 300 - y);
            ctx.fillText(barText[i], x + 40, 300 - y - 20);
        }

        // ~~~ 配当金の買い目ごとの割合 ~~~

        const elmPieChart = document.getElementById('pie-chart');
        const ctxPieChart = elmPieChart.getContext('2d');

        var angleTriple = 360 * ( 50 / 100 );
        var angleQuinella = 360 * ( 30 / 100 );
        var angleTrifecta = 360 * ( 20 / 100 );

        const pieColorArray = ['red', 'blue', 'yellow'];
        const angleArray = [angleTriple, angleQuinella, angleTrifecta];

        let angleValStart = 0;
        let angleValEnd = 0;
        for (i=0; i<angleArray.length; i++) {
            angleValEnd += angleArray[i];
            let pieColor = pieColorArray[i];

            ctxPieChart.beginPath();
            ctxPieChart.arc( 100, 100, 100, angleValStart * Math.PI / 180, angleValEnd * Math.PI / 180, false );
            ctxPieChart.lineTo(100, 100);
            ctxPieChart.fillStyle = pieColor;
            ctxPieChart.fill();

            angleValStart += angleArray[i];
        }
    })();
</script>

{% endblock contents %}
